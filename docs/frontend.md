# Frontend Guidelines

- **CoreNode (safe, анализируемый)**: пишем реакции только через DSL (`Expr`, `If`, `Delay`, арифметика). Python `if/while/ternary/len` над `Expr` запрещены: теперь это даёт явную ошибку. Допустимы только статические циклы `for` с константным `range(...)`, без зависимостей от входов/состояний.
- **ExtNode/RawNode (unsafe, чёрный ящик)**: можно использовать произвольный Python и динамические циклы/горизонты. Формальные гарантии причинности/NonZeno/конфликтов не предоставляются. Мгновенные циклы с Raw запрещены; для Ext разрешается только при контракте `no_instant_loop` или явной задержке.
- **Обратные связи**: если нужны гарантии конструктивности и контроля микрошагов, используем CoreNode с явными `Delay` или ранжированием (`rank`/`max_microsteps`). Ext/Raw в таких петлях допустимы только как “unsafe”.
- **Типовые переписывания**: clamp — через `min/max` в DSL, wrap-angle — через арифметику/модуль без Python `while`, интегратор — через `State.set` + `Delay`.
- **ContinuousNode**: его нужно оборачивать в ContinuousWrapper (обычно вместе с ZOH/Sampler). Для нескольких растений/контроллеров не полагайтесь на `auto_wire` по коротким именам: либо уникализируйте порты (префиксы), либо подключайте явно через `>>`.

Эта схема: Core даёт проверки и видимость зависимостей; Ext/Raw дают свободу (динамические циклы, сложные лоссы), но без гарантий и с ограничениями на мгновенные петли.
